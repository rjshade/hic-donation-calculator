



<!-- I said not to look at the source Matt... -->
<!-- That said, if you love refactoring other people's code, then get involved! -->




<!DOCTYPE html>
<html lang="en">
<head>
    <title>high impact careers :: donation calculator</title>


    <style type="text/css">
        body
        {
            background: #555;
            color: #e4e4e4;
            margin:auto;
            padding-top: 40px;
        }

        #container
        {
            width: 800px;
            margin-left: auto;
            margin-right: auto;

            padding: 30px;
            border: 1px solid #ccc;
            background: #999;

            text-align:center;
            

        }
    </style>


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <script src="./js/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="./js/jquery-ui-1.8.14.custom.min.js" type="text/javascript"></script>
    <script src="./js/highcharts.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" media="screen" title="User Defined Style" href="./styles/jqueryui.css" />

    </style>

<script>
    var chart1; // globally available
    function drawCanvasPeople( number )
    {
        var buttonsToDraw = number / 10;

        var buttonWidth  = 12;
        var buttonHeight = 12;

        var buttonsPerRow = 60;

        var canvas = document.getElementById('myCanvas');
        canvas.width = buttonsPerRow * buttonWidth;
        canvas.height = Math.ceil( buttonsToDraw / buttonsPerRow ) * buttonHeight;

        if (canvas.getContext)
        {
            var ctx = canvas.getContext('2d');

            person = new Image();
            person.src = "./images/person.png"
            person.onload = function() 
            {
                var col = 0;
                var row = 0;
                for( var num = 0; num < buttonsToDraw; num++ )
                {
                    ctx.drawImage( person, buttonWidth*col, buttonHeight*row )
                    col++
                    if( col >= buttonsPerRow )
                    { row++; col = 0; }
                }

            }
        }
    }

    // earningProfile is pairs of [year, salary]
    var earningProfile = []
    for( i = 0; i < 60; i++ )
    {
        earningProfile[i] = [i, 100 * (0.1 * Math.random() + 1) * Math.pow(i,2)];
    }


    var donationProfile = [[0,30], [35000,30], [150000,30], [999999999,30] ];

    var earningData = []
    var donationData = []


    function fillEarningData( earningProfile )
    {
        for( step = 0; step < earningProfile.length - 1; step++ )
        {
            var salary = earningProfile[step][1];
            for( year = earningProfile[step][0]; year < earningProfile[step+1][0]; year++ )
            {
                earningData[year] = salary;
            }
        }
        chart1.series[0].setData(earningData);
    }

    function fillDonationData( donationProfile )
    {
        year = 0;
        var donationData_graph = [];
        for( step = 0; step < donationProfile.length - 1; step++ )
        {
            var lower_bound = donationProfile[step][0]
            var upper_bound = donationProfile[step+1][0]

            var percentage = donationProfile[step][1];

            while( earningData[year] >= lower_bound && earningData[year] < upper_bound )
            {
                // inverted % for graph as we want to show it *above* the earnings
                donationData_graph[year] = earningData[year] * (100-percentage)/100;
                donationData[year] = earningData[year] * percentage/100;
                year++;
            }
        }
        chart1.series[1].setData(donationData_graph);
    }


    function calculateMoneyDonated()
    {
        var total = 0
        for( year = 0; year < donationData.length; year++ )
        {
            total += donationData[year]
        }

        $( "#money_donated" ).html("£" + total.toFixed(0))
        $( "#lives_saved" ).html( (total / 300).toFixed(0) )

        drawCanvasPeople( (total / 300).toFixed(0) );
    }


    function updateDonationProfile()
    {
        donationProfile[0][1] = $( "#slider_band_0" ).slider("value");
        donationProfile[1][1] = $( "#slider_band_1" ).slider("value");
        donationProfile[2][1] = $( "#slider_band_2" ).slider("value");
    }
     function band0_update( event, ui ) {
                $( "#percentage_band_0" ).html( ui.value + "%" );

                donationProfile[0][1] = ui.value;

                fillEarningData( earningProfile );
                fillDonationData( donationProfile );
        calculateMoneyDonated();

    }


     function band1_update( event, ui ) {
                $( "#percentage_band_1" ).html( ui.value + "%" );

                donationProfile[1][1] = ui.value;

                fillEarningData( earningProfile );
                fillDonationData( donationProfile );
        calculateMoneyDonated();
    }


     function band2_update( event, ui ) {
                $( "#percentage_band_2" ).html( ui.value + "%" );

                donationProfile[2][1] = ui.value;

                fillEarningData( earningProfile );
                fillDonationData( donationProfile );
        calculateMoneyDonated();
    }

    $(function() {

        $( "#slider_band_0" ).slider({
            range: "min",
            value: 30,
            min: 10,
            max: 100,
            orientation: 'vertical',
            change: band0_update,
            slide: band0_update
        });

        $( "#slider_band_1" ).slider({
            range: "min",
            value: 30,
            min: 10,
            max: 100,
            orientation: 'vertical',
            change: band1_update,
            slide: band1_update
        });


        $( "#slider_band_2" ).slider({
            range: "min",
            value: 30,
            min: 10,
            max: 100,
            orientation: 'vertical',
            change: band2_update,
            slide: band2_update

        });

        $( "#percentage_band_0" ).html( $( "#slider_band_0" ).slider( "value" ) + "%" );
        $( "#percentage_band_1" ).html( $( "#slider_band_1" ).slider( "value" ) + "%" );
        $( "#percentage_band_2" ).html( $( "#slider_band_2" ).slider( "value" ) + "%" );


      chart1 = new Highcharts.Chart({

         chart: {
            renderTo: 'chart-container',
            type: 'area'
         },

         title: {
            text: 'earnings and donations'
         },

         xAxis: {
            title: {
                text: 'years'
            }
         },

         yAxis: {
            title: {
               text: '£'
            }
         },


      plotOptions: {
        area: {
            marker: {
               enabled: false,
               symbol: 'circle',
               radius: 2,
               states: {
                  hover: {
                     enabled: true
                  }
               }
            }
         }
      },

         series: [{
            name: 'Earnings',
            data: []
         }, {
            name: 'Donations',
            data: []
         }]
      });

      updateDonationProfile()
      fillEarningData( earningProfile );
      fillDonationData( donationProfile );
        calculateMoneyDonated();
    });


</script>

    <style>
    #demo-frame > div.demo { padding: 10px !important; }

    .tax-band-slider {
        margin:15px; 
        width: 200px;
        height: 150px;
        display: inline-block;
        letter-spacing: normal;
        font-size: normal;
        white-space: normal;
        text-align: normal;
        vertical-align: middle;
    }
    .tax-band-slider .money
    { font-size: 1.5em;}
    .tax-band-slider .percentage
    { font-size: 5em; float: right}


    #money_donated
    { font-weight: bold; font-size: 1.5em }
    #lives_saved
    { font-weight: bold; font-size: 1.5em }

    </style>
    <script>


    </script>


    
    
</head>

<body>
    <div id="container">

        <div id="chart-container" style="width: 100%; height: 300px"></div>


        <div class="tax-band-slider">
            <div class="money"      id="money_band_0">£0-£35000</div>
            <div class="percentage" id="percentage_band_0">10%</div>
            <div class="slider"     id="slider_band_0"></div>
        </div>

        <div class="tax-band-slider">
            <div class="money"      id="money_band_1">£35000-£150000</div>
            <div class="percentage" id="percentage_band_1">20%</div>
            <div class="slider"     id="slider_band_1"></div>
        </div>

        <div class="tax-band-slider">
            <div class="money"      id="money_band_2">over £150000</div>
            <div class="percentage" id="percentage_band_2">50%</div>
            <div class="slider"     id="slider_band_2"></div>
        </div>
    

        <div class="impact">
            you will donate <span id="money_donated">£0</span> over your lifetime which could save <span id="lives_saved">0</span> lives
        </div>

        <img src="./images/person_button.png" />

        <canvas id="myCanvas" width="800px" height="400px">No canvas support.</canvas> 
    </div>



</body>

</html>
